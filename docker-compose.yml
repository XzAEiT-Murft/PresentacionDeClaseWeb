version: '3.8'

services:
  # Servicio 1: Nuestra API del backend
  backend:
    build: ./backend  # Le dice dónde encontrar el Dockerfile
    container_name: peliplus_api
    ports:
      - "3000:3000" # Mapea el puerto 3000 de tu PC al 3000 del contenedor
    volumes:
      # Sincroniza tu código local con el del contenedor
      # Si cambias código en tu PC, se refleja en el contenedor (¡muy útil!)
      - ./backend:/usr/src/app
      # Importante: Evita que la carpeta node_modules local reemplace
      # la que se instaló DENTRO del contenedor.
      - /usr/src/app/node_modules 
    environment:
      # Esta es la URL de conexión. 'mongo' es el nombre del servicio de abajo.
      DB_URI: mongodb://mongo:27017/peliplus
    depends_on:
      - mongo # Le dice que no inicie 'backend' hasta que 'mongo' esté listo

  # Servicio 2: Nuestra Base de Datos MongoDB
  mongo:
    image: mongo:7.0  # Usamos la imagen oficial de Mongo (v7 es muy estable)
    container_name: peliplus_db
    ports:
      - "27017:27017" # Puerto estándar de MongoDB
    volumes:
      # Esto "persiste" los datos. Si apagas el contenedor, 
      # tus datos no se borran, quedan guardados en un volumen llamado 'mongo-data'.
      - mongo-data:/data/db 

volumes:
  mongo-data: # Aquí se define el volumen